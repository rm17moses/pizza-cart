<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zandile's Perfect Pizza</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="//unpkg.com/alpinejs" defer></script>
  <link rel="icon" type="image/png" href="images/page.png">
</head>

<body class="container bg-info bg-gradient text-dark p-3" >
  <div x-data="{
    pizzas: [
      { id: 1, name: 'Margherita', description: 'A classic pizza offering a simple yet delicious combination of flavors.', toppings: ['Basil Leaves', 'Mozzarella Cheese', 'Tomato Sauce', 'Olive Oil', 'Grated Parmesan Cheese'], price: 79.99, image: 'images/Margherita.png', selectedToppings: [] },
      { id: 2, name: 'Ham & Mushroom', description: 'This pizza combines smoky ham slices with earthy mushrooms.', toppings: ['Ham', 'Mozzarella Cheese', 'Tomato Sauce', 'Mushrooms', 'Fresh Herbs'], price: 99.99, image: 'images/Ham and Mushroom.png', selectedToppings: [] },
      { id: 3, name: 'Chicken & Mushroom', description: 'A delectable combination of tender chicken pieces and savory mushrooms.', toppings: ['Chicken', 'Mozzarella Cheese', 'Red Onions', 'Mushrooms', 'Fresh Herbs'], price: 119.99, image: 'images/Chicken and Mushroom.png', selectedToppings: [] }
    ],
    cart: [],
    totalCost: 0,
    paymentAmount: 0,
    paymentMessage: '',
    initializeCart: function() {
      const cartData = localStorage.getItem('cart');
      if (cartData) {
        this.cart = JSON.parse(cartData);
        this.calculateTotalCost();
      }
    },
    addToCart: function(pizza) {
  const existingItem = this.cart.find(function(item) {
    return item.id === pizza.id;
  });

  if (existingItem) {
    existingItem.quantity++;
  } else {
    let price = pizza.price;
    if (pizza.selectedToppings.length > 3) {
      price += 10;
    }
    this.cart.push({ ...pizza, quantity: 1, price });
  }

  this.calculateTotalCost();
  this.saveCartToStorage();
},
    removeFromCart: function(item) {
      const index = this.cart.indexOf(item);
      if (index !== -1) {
        this.cart.splice(index, 1);
        this.calculateTotalCost();
        this.saveCartToStorage();
      }
    },
    increaseQuantity: function(item) {
      item.quantity++;
      this.calculateTotalCost();
      this.saveCartToStorage();
    },
    decreaseQuantity: function(item) {
      if (item.quantity > 0) {
        item.quantity--;
        this.calculateTotalCost();
        this.saveCartToStorage();
      }
    },
    calculateTotalCost: function() {
      var total = 0;
      for (var i = 0; i < this.cart.length; i++) {
        var item = this.cart[i];
        total += item.price * item.quantity;
      }
      this.totalCost = total;
    },
    saveCartToStorage: function() {
      localStorage.setItem('cart', JSON.stringify(this.cart));
    },
    checkout() {
      if (this.cart.length === 0) {
        return; // No pizzas in the cart, exit the function
      }
      // Open the payment modal
      let paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
      paymentModal.show();
    },
    processPayment() {
      if (this.paymentAmount >= this.totalCost) {
        this.paymentMessage = 'Enjoy your pizzas!';
        this.cart = [];
        this.totalCost = 0;
        localStorage.removeItem('cart');
      } else {
        this.paymentMessage = 'Sorry, that is not enough money!';
      }
      this.paymentAmount = 0;
    },
    clearCart: function() {
      this.cart = [];
      this.totalCost = 0;
      localStorage.removeItem('cart');
    },
    
    isToppingSelected: function(pizza, topping) {
      return pizza.selectedToppings.includes(topping);
    },
   
    // existing data and methods
  scrollToCart: function() {
    const cartSection = document.getElementById('cartSection');
    if (cartSection) {
      cartSection.scrollIntoView({ behavior: 'smooth' });
    }
  },
}" x-init="initializeCart()" @scroll.window="handleScroll">
<div style="--bs-bg-opacity: .7;" class="container border text-center bg-warning bg-gradient text-center card p-3 mb-3" >
  <h1>Zandile's Perfect Pizza</h1>
  <p>Welcome to Zandile's Perfect Pizza! Order your favorite pizzas online.</p>
</div>

  
    <div class="text-center card bg-dark bg-gradient text-emphasis-info mb-3 p-4" style="--bs-bg-opacity: .75;" x-show="cart.length > 0">
      <h2 class="text-center pt-4 pb-4 mb-3 text-white" id="cartSection"><i class="bi bi-cart"></i> Shopping cart</h2>
  
      <table class="table table-responsive table-bordered table-sm p-3">
        <thead>
          <tr>
            <th scope="col">Pizza</th>
            <th scope="col">Quantity</th>
            <th scope="col">Total</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="item in cart" :key="item.id">
            <tr>
              <td>
                <span x-text="item.name"></span>
              </td>
              <td>
                <button class="btn btn-sm btn-outline-danger me-1" @click="decreaseQuantity(item)"><i class="bi bi-dash-lg icons icon-link-hover"></i></button>
                <span x-text="item.quantity"></span>
                <button class="btn btn-sm btn-outline-success ms-1" @click="increaseQuantity(item)"><i class="bi bi-plus-lg fw-bold icons icon-link-hover"></i></button>
              </td>
              <td>R<span x-text="(item.price * item.quantity).toFixed(2)"></span></td>
            </tr>
          </template>
          <tr>
            <td colspan="2" class="text-end fw-bold">
              <i class="bi bi-credit-card-fill"></i> Total Cost: <span
                  class="counter align-items-right fw-bold" x-text="totalCost().toFixed(2)"></span></mark>
            </td>
            <td colspan="2">R<span x-text="totalCost.toFixed(2)"></span></td>
          </tr>
        </tbody>
      </table>
  
      <div class="text-center">
        <button class="btn btn-danger" @click="clearCart"> <i class="bi bi-cart-x-fill"></i> Clear Cart</button>
        <button class="btn btn-primary" @click="checkout" x-show="cart.length > 0"><i class="bi bi-cart-check-fill text-white icons icon-link-hover"></i> Check Out</button>
      </div>
    </div>
  
    <div class="card p-4 mb-3 bg-secondary-subtle bg-gradient text-emphasis-warning" style="--bs-bg-opacity: .9;">
      <h2 class="text-center">Pizza Menu</h2>
      <div class="row">
        <template x-for="pizza in pizzas" :key="pizza.id">
          <div class="col-md-4 mb-1 ">
            <div class="card h-100 d-flex flex-column bg-info-subtle bg-gradient text-emphasis-secondary">
              <img :src="pizza.image" class="card-img-top" alt="Pizza Image">
              <div class="card-body d-flex flex-column justify-content-between">
                  
                  <div class="d-flex justify-content-between">
                    <h5 class="card-title" x-text="pizza.name"></h5>

                    <button class="btn btn-warning p-0">                    
                      <p class="card-text d-flex justify-content-end" x-text="'R' + pizza.price.toFixed(2)"></p>
                    </button>

                 
                  
                  </div>
                  <p class="card-text" x-text="pizza.description"></p>
                    
                  
                <div>
                  <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" :id="'toppingsDropdown-' + pizza.id" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      Select Toppings <i class="bi bi-folder2-open text-white icons icon-link-hover"></i>
                    </button>
                    <ul class="dropdown-menu ps-2 pe-2" :aria-labelledby="'toppingsDropdown-' + pizza.id" x-data>
                      <template x-for="topping in pizza.toppings" :key="topping">
                        <li>
                          <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" :disabled="MaxToppingsSelected(pizza) && !isToppingSelected(pizza, topping)" x-model="pizza.selectedToppings" :value="topping">
                            <span x-text="topping"></span>
                          </label>
                        </li>
                      </template>
                    </ul>
                  </div>
                  <button class="btn btn-success position-relative mt-2" id="viewCartBtn" x-show="cart.length > 0" @click="scrollToCart()" ><i class="bi bi-cursor-fill text-white icons icon-link-hover"></i> View cart
                    <span class="position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle">
                      <span class="visually-hidden">New alerts</span>
                    </span>
                  </button>
                  <button class="btn btn-primary mt-2 fw-bold" @click="addToCart(pizza)" style="width: 100%;">Order</button>

                </div>
              </div>
            </div>
          </div>
        </template>
      </div>
    </div>
    
  <!-- Add the "View my cart" button and the modal here -->

  
<!-- Add this section below the <div x-data> closing tag -->
  <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true" x-data="{ paymentMessage: '', }">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="paymentModalLabel">Enter Payment Amount</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Display the payment message with dynamic classes based on the payment result -->
          <div :class="['mb-3', { 'bg-success text-white fw-bold': paymentMessage === 'Enjoy your pizzas!', 'bg-danger text-white fw-bold': paymentMessage !== 'Sorry, that is not enough money!'}]" x-text="paymentMessage" class="bg-primary text-white fw-bold pe-3 ps-3"></div>
          <div class="input-group mb-3">
            <span class="input-group-text"><b>R</b></span>
          <input type="number" class="form-control" placeholder="Payment Amount" x-model="paymentAmount">
          
        </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" @click="processPayment"> <i class="bi bi-currency-exchange"></i> Pay</button>
        </div>
      </div>
    </div>
  </div>
  


    
  </div>
  <footer class="text-center pt-4">
    <div class="container bg-dark card bg-gradient text-white p-3">
      <p>&copy; 2023 | All rights reserved | Moses Moletsane </p>
      <div class="container">
        <p>
          <i class="bi bi-geo-alt-fill text-white icons icon-link-hover"></i> 58 3rd Avenue, Westdene, Gauteng</p>
        <p class="icons">
          <a href="https://wa.me/27734907149" target="_blank" class="text-white "><i class="bi bi-whatsapp hover "></i></a> &nbsp;&nbsp;
          <a href="https://t.me/MosesMoletsane" target="_blank" class="text-white icon-link-hover"><i class="bi bi-telegram"></i></a> &nbsp;&nbsp;
          <a href="mailto:mosesmoletsane17@gmail.com" class="text-white icon-link-hover"><i class="bi bi-envelope-fill"></i></a> &nbsp;&nbsp;
          <a href="https://www.linkedin.com/in/moses-moletsane-5b6aa3161/" target="_blank" class="text-white"><i class="bi bi-linkedin"></i></a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>
